# Readme

## 运行

### 服务端

- 直接运行 在127.0.0.1: 10001（默认，可更改）启动服务器
- 接收的文件默认储存在{$同目录/pan/} 路径下

### 客户端

- 运行后可以运行以下命令：

  - help    查看帮助手册（简陋）
  - upload [file_path]    上传文件（可以是相对路径）
  - ls    查看服务器文件列表 包含（id， filename， file_size，uploader_address)信息
  - download [id]    根据文件id下载文件 默认下载到相同路径 
  - q / quit    退出

## 代码说明

- 线程

  - 服务器对每一个新用户都会开一个新线程，用于处理用户的所有行为

  - 新开的线程为守护进程 随着主进程关闭，子线程也会关闭

  ```python
  new_thread = threading.Thread(target=handle_single_connect, args=(connect, address,))  # 用独立的线程管理每一个conn
  new_thread.setDaemon(True)  # 设置守护进程
  new_thread.start()
  ```

- 序列化
  - 处理文件发送时，先对每个文件生成一个文件头，包含文件名和文件大小。用json.dumps命令进行序列化
  - 对于文件头，将文件长度包装为C-int（4字节）数据，进行先行发送

## 可能存在的问题

注：指**满足实验**要求情况下，系统对某一些误操作没有还原手段

- 文件列表存在内存中，没有进行持久化储存，所以重新运行服务器后上次上传的文件情况无法恢复

- 查看服务器文件列表时，如果列表过大可能会有问题
- 传输过程中断开没有恢复措施 并且可能会出现不可逆转的问题
- 没有加入进度条 如果单个文件过大 会卡顿 降低客户端用户人机交互性